// Participants table: display name for email is 'Participant_Email (Primary)'
Set(
    varMe,
    LookUp(
        Participants,
        'Participant_Email (Primary)' = User().Email
    )
);


// Build a single record with Match, my link, partner link, and partner participant
Set(
    varLatestMatch,
    With(
        {
            myLastLink: First(
                Sort(
                    Filter('Match_Member', 'Participant_Email' = varMe),   // lookup→lookup
                    'Created On',
                    Descending
                )
            )
        },
        If(
            IsBlank(myLastLink),
            Blank(),
            With(
                {
                    matchRow: myLastLink.'Match', // lookup to Match
                    partnerLink: LookUp(
                        'Match_Member',
                        'Match' = matchRow &&
                        'Participant_Email' <> varMe
                    ),
                    partnerRow: If(!IsBlank(partnerLink), partnerLink.'Participant_Email') // lookup to Participant
                },
                {
                    // Nice, bindable shape
                    MatchID: matchRow.'ID (Primary)',   // Match table’s primary name / autonumber
                    Match: matchRow,                    // full Match record
                    MyLink: myLastLink,                 // my Match_Member row
                    PartnerLink: partnerLink,           // partner’s Match_Member row
                    Partner: partnerRow                 // full Participant record
                }
            )
        )
    )
);

ClearCollect(
    colMyMatches,
    AddColumns(
        Sort(
            Filter('Match_Member', 'Participant_Email' = varMe),
            'Created On',
            Descending
        ),
        "MatchRow",    ThisRecord.'Match',
        "PartnerLink", LookUp(
                           'Match_Member',
                           'Match' = ThisRecord.'Match' &&
                           'Participant_Email' <> varMe
                       ),
        "PartnerRow",  If(!IsBlank(PartnerLink), PartnerLink.'Participant_Email')
    )
);

